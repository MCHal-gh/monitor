name: Kontrola Planetum PythonAnywhere

on:
  schedule:
    - cron: '0 0 * * *'  # Spou≈°t√≠ se ka≈æd√Ω den v p≈Ølnoci
  workflow_dispatch:     # Umo≈æ≈àuje ruƒçn√≠ spu≈°tƒõn√≠ workflow

jobs:
  run_scraper:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout k√≥d üì¶
        uses: actions/checkout@v4

      - name: Nastaven√≠ Python 3.11 üêç
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: Instalace z√°vislost√≠ a Chromium üõ†Ô∏è
        run: |
          echo "üîß Instalace Chromium a Python knihoven..."
          sudo apt-get update
          sudo apt-get install -y libxss1 libappindicator1 libindicator7 build-essential
          sudo apt-get install -y chromium-browser || sudo apt-get install -y chromium
          pip install --upgrade pip
          pip install selenium requests beautifulsoup4

      - name: Zjisti cestu k Chromium üîç
        id: find_chromium
        run: |
          set -e
          chromium_path="$(which chromium || which chromium-browser || true)"
          if [ -z "$chromium_path" ]; then
            echo "‚ùå Chromium nebyl nalezen!"
            exit 1
          fi
          echo "‚úÖ Nalezen Chromium na cestƒõ: $chromium_path"
          echo "CHROME_BIN=$chromium_path" >> $GITHUB_ENV

      - name: Kontrola verze Chromium üåê
        run: |
          $CHROME_BIN --version

      - name: Spu≈°tƒõn√≠ Python skriptu üöÄ
        env:
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_PASSWORD: ${{ secrets.GMAIL_PASSWORD }}
          CHROME_BIN: ${{ env.CHROME_BIN }}
        run: |
          echo "‚ñ∂Ô∏è Spou≈°t√≠m Python skript s Chromiem: $CHROME_BIN"
          python planetum_kontrola_gmail_pythonanywhere.py
          echo "‚úÖ Skript dokonƒçen."
